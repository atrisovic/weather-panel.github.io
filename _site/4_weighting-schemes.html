<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,minimum-scale=1">

  <title>Weighting schemes</title>
  <meta name="description" content="        4. Weighting schemes This section describes how to use different weighting schemes when aggregating gridded data to data regions.Why spatial weightin...">

  <link rel="canonical" href="/YOUR%20URL//4_weighting-schemes.html">
  <link rel="alternate" type="application/rss+xml" title="Weather Panel Tutorial" href="/YOUR%20URL//feed.xml">

  <meta property="og:url"         content="/YOUR%20URL//4_weighting-schemes.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Weighting schemes" />
<meta property="og:description" content="        4. Weighting schemes This section describes how to use different weighting schemes when aggregating gridded data to data regions.Why spatial weightin..." />
<meta property="og:image"       content="YOUR%20URL/images/logo/CIL-Logo.png" />

<meta name="twitter:card" content="summary">


  <script type="application/ld+json">
  {
  "@context": "http://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": "YOUR URL//4_weighting-schemes.html",
  "headline": "Weighting schemes",
  "datePublished": "2019-11-12T15:26:12-05:00",
  "dateModified": "2019-11-12T15:26:12-05:00",
  "description": "        4. Weighting schemes This section describes how to use different weighting schemes when aggregating gridded data to data regions.Why spatial weightin...",
  "author": {
    "@type": "Person",
    "name": "Azhar Hussain, James Rising, Kevin Schwarzwald, Ana Trisovic"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Data 100 at UC Berkeley",
    "logo": {
      "@type": "ImageObject",
      "url": "YOUR URL/",
      "width": 60,
      "height": 60
    }
  },
  "image": {
    "@type": "ImageObject",
    "url": "YOUR URL/",
    "height": 60,
    "width": 60
  }
}

  </script>
  <link rel="stylesheet" href="/assets/css/styles.css">

  <!-- <link rel="manifest" href="/manifest.json"> -->
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#efae0a"> -->
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="msapplication-TileImage" content="/mstile-144x144.png">
  <meta name="theme-color" content="#233947">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/images/logo/favicon.ico">

  <!-- MathJax Config -->
  <!-- Allow inline math using $ and automatically break long math lines -->
<!-- (mostly) copied from nbconvert configuration -->
<!-- https://github.com/jupyter/nbconvert/blob/master/nbconvert/templates/html/mathjax.tpl -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true,
        processEnvironments: true
    },
    // Center justify equations in code and markdown cells. Elsewhere
    // we use CSS to left justify single line equations in code cells.
    displayAlign: 'center',
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}},
        linebreaks: { automatic: true },
    }
});
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML' async></script>


  <!-- DOM updating function -->
  <script src="/assets/js/page/dom-update.js"></script>

  <!-- Selectors for elements on the page -->
  <script src="/assets/js/page/documentSelectors.js"></script>

  <!-- Define some javascript variables that will be useful in other javascript -->
  <script>
    const site_basename = '/';
  </script>

  <!-- Add AnchorJS to let headers be linked -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js" async></script>
  <script src="/assets/js/page/anchors.js" async></script>

  <!-- Include Turbolinks to make page loads fast -->
  <!-- https://github.com/turbolinks/turbolinks -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/turbolinks/5.2.0/turbolinks.js" async></script>
  <meta name="turbolinks-cache-control" content="no-cache">

  <!-- Load nbinteract for widgets -->
  

  <!-- Load Thebelab for interactive widgets -->
  <!-- Include Thebelab for interactive code if it's enabled -->


<!-- Display Thebelab button in each code cell -->
<script>
/**
 * Set up thebelab button for code blocks
 */

const thebelabCellButton = id =>
  `<a id="thebelab-cell-button-${id}" class="btn thebebtn o-tooltip--left" data-tooltip="Interactive Mode">
    <img src="/assets/images/edit-button.svg" alt="Start thebelab interactive mode">
  </a>`


const addThebelabButtonToCodeCells =  () => {

  const codeCells = document.querySelectorAll('div.input_area > div.highlight:not(.output) pre')
  codeCells.forEach((codeCell, index) => {
    const id = codeCellId(index)
    codeCell.setAttribute('id', id)
    if (document.getElementById("thebelab-cell-button-" + id) == null) {
      codeCell.insertAdjacentHTML('afterend', thebelabCellButton(id));
    }
  })
}

initFunction(addThebelabButtonToCodeCells);
</script>



<script type="text/x-thebe-config">
    {
      requestKernel: true,
      binderOptions: {
        repo: 'YOUR-ORG/YOUR-REPO',
        ref: 'gh-pages',
      },
      codeMirrorConfig: {
        theme: "abcdef"
      },
      kernelOptions: {
        name: 'python3',
      }
    }
</script>
<script src="https://unpkg.com/thebelab@0.4.0/lib/index.js" async></script>
<script>
    /**
     * Add attributes to Thebelab blocks
     */

    const initThebelab = () => {
        const addThebelabToCodeCells = () => {
            console.log("Adding thebelab to code cells...");
            // If Thebelab hasn't loaded, wait a bit and try again. This
            // happens because we load ClipboardJS asynchronously.
            if (window.thebelab === undefined) {
                setTimeout(addThebelabToCodeCells, 250)
            return
            }

            // If we already detect a Thebelab cell, don't re-run
            if (document.querySelectorAll('div.thebelab-cell').length > 0) {
                return;
            }

            // Find all code cells, replace with Thebelab interactive code cells
            const codeCells = document.querySelectorAll('.input_area pre')
            codeCells.forEach((codeCell, index) => {
                const id = codeCellId(index)
                codeCell.setAttribute('data-executable', 'true')

                // Figure out the language it uses and add this too
                var parentDiv = codeCell.parentElement.parentElement;
                var arrayLength = parentDiv.classList.length;
                for (var ii = 0; ii < arrayLength; ii++) {
                    var parts = parentDiv.classList[ii].split('language-');
                    if (parts.length === 2) {
                        // If found, assign dataLanguage and break the loop
                        var dataLanguage = parts[1];
                        break;
                    }
                }
                codeCell.setAttribute('data-language', dataLanguage)

                // If the code cell is hidden, show it
                var inputCheckbox = document.querySelector(`input#hidebtn${codeCell.id}`);
                if (inputCheckbox !== null) {
                    setCodeCellVisibility(inputCheckbox, 'visible');
                }
            });

            // Remove the event listener from the page so keyboard press doesn't
            // Change page
            document.removeEventListener('keydown', initPageNav)
            keyboardListener = false;

            // Init thebelab
            thebelab.bootstrap();

            // Remove copy buttons since they won't work anymore
            const copyAndThebeButtons = document.querySelectorAll('.copybtn, .thebebtn')
            copyAndThebeButtons.forEach((button, index) => {
                button.remove();
            });

            // Remove outputs since they'll be stale
            const outputs = document.querySelectorAll('.output *, .output')
            outputs.forEach((output, index) => {
                output.remove();
            });

            // Find any cells with an initialization tag and ask ThebeLab to run them when ready
            var thebeInitCells = document.querySelectorAll('div.tag_thebelab-init');
            thebeInitCells.forEach((cell) => {
                console.log("Initializing ThebeLab with cell: " + cell.id);
                cell.querySelector('.thebelab-run-button').click();
            });
        }

        // Add event listener for the function to modify code cells
        const thebelabButtons = document.querySelectorAll('[id^=thebelab], [id$=thebelab]')
        thebelabButtons.forEach((thebelabButton,index) => {
            if (thebelabButton === null) {
                setTimeout(initThebelab, 250)
                return
            };
            thebelabButton.addEventListener('click', addThebelabToCodeCells);
        });
    }

    // Initialize Thebelab
    initFunction(initThebelab);
</script>



  <!-- Load the auto-generating TOC (non-async otherwise the TOC won't load w/ turbolinks) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js" async></script>
  <script src="/assets/js/page/tocbot.js"></script>

  <!-- Google analytics -->
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>



  <!-- Clipboard copy button -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" async></script>

  <!-- Load custom website scripts -->
  <script src="/assets/js/scripts.js" async></script>

  <!-- Load custom user CSS and JS  -->
  <script src="/assets/custom/custom.js" async></script>
  <link rel="stylesheet" href="/assets/custom/custom.css">

  <!-- Update interact links w/ REST param, is defined in includes so we can use templates -->
  

  <!-- Lunr search code - will only be executed on the /search page -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" async></script>
  <script>var initQuery = function() {
  // See if we have a search box
  var searchInput = document.querySelector('input#lunr_search');
  if (searchInput === null) {
    return;
  }

  // Function to parse our lunr cache
  var idx = lunr(function () {
    this.field('title')
    this.field('excerpt')
    this.field('categories')
    this.field('tags')
    this.ref('id')

    this.pipeline.remove(lunr.trimmer)

    for (var item in store) {
      this.add({
        title: store[item].title,
        excerpt: store[item].excerpt,
        categories: store[item].categories,
        tags: store[item].tags,
        id: item
      })
    }
  });

  // Run search upon keyup
  searchInput.addEventListener('keyup', function () {
    var resultdiv = document.querySelector('#results');
    var query = document.querySelector("input#lunr_search").value.toLowerCase();
    var result =
      idx.query(function (q) {
        query.split(lunr.tokenizer.separator).forEach(function (term) {
          q.term(term, { boost: 100 })
          if(query.lastIndexOf(" ") != query.length-1){
            q.term(term, {  usePipeline: false, wildcard: lunr.Query.wildcard.TRAILING, boost: 10 })
          }
          if (term != ""){
            q.term(term, {  usePipeline: false, editDistance: 1, boost: 1 })
          }
        })
      });

      // Empty the results div
      while (resultdiv.firstChild) {
        resultdiv.removeChild(resultdiv.firstChild);
      }

    resultdiv.insertAdjacentHTML('afterbegin', '<p class="results__found">'+result.length+' Result(s) found</p>');
    for (var item in result) {
      var ref = result[item].ref;
      if(store[ref].teaser){
        var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<div class="archive__item-teaser">'+
                '<img src="'+store[ref].teaser+'" alt="">'+
              '</div>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      else{
    	  var searchitem =
          '<div class="list__item">'+
            '<article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">'+
              '<h2 class="archive__item-title" itemprop="headline">'+
                '<a href="'+store[ref].url+'" rel="permalink">'+store[ref].title+'</a>'+
              '</h2>'+
              '<p class="archive__item-excerpt" itemprop="description">'+store[ref].excerpt.split(" ").splice(0,20).join(" ")+'...</p>'+
            '</article>'+
          '</div>';
      }
      resultdiv.insertAdjacentHTML('beforeend', searchitem);
    }
  });
};

initFunction(initQuery);
</script>

  <!-- Load JS that depends on site variables -->
  <script src="/assets/js/page/copy-button.js" async></script>

  <!-- Hide cell code -->
  <script src="/assets/js/page/hide-cell.js" async></script>

  <!-- Printing the screen -->
  <!-- Include nbinteract for interactive widgets -->
<script src="https://printjs-4de6.kxcdn.com/print.min.js" async></script>
<script>
printContent = () => {
    // MathJax displays a second version of any math for assistive devices etc.
    // This prevents double-rendering in the PDF output.
    var ignoreAssistList = [];
    assistives = document.querySelectorAll('.MathJax_Display span.MJX_Assistive_MathML').forEach((element, index) => {
        var thisId = 'MathJax-assistive-' + index.toString();
        element.setAttribute('id', thisId);
        ignoreAssistList.push(thisId)
    });

    // Print the actual content object
    printJS({
        printable: 'textbook_content',
        type: 'html',
        css: "/assets/css/styles.css",
        style: "#textbook_content {padding-top: 40px};",
        scanStyles: false,
        targetStyles: ["*"],
        ignoreElements: ignoreAssistList,
        documentTitle: "Made with Jupyter Book"
    })
};

initPrint = () => {
    document.querySelector('#interact-button-print').addEventListener('click', printContent)
}

initFunction(initPrint)
</script>

</head>

  <body>
    <!-- .js-show-sidebar shows sidebar by default -->
    <div id="js-textbook" class="c-textbook js-show-sidebar">
      



<nav id="js-sidebar" class="c-textbook__sidebar">
  <a href="http://www.impactlab.org"><img src="/images/logo/CIL-Logo.png" class="textbook_logo" id="sidebar-logo" alt="textbook logo" data-turbolinks-permanent/></a>
  <h2 class="c-sidebar__title">Weather Panel Tutorial</h2>
  <ul class="c-sidebar__chapters">
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/1_getting-started.html"
        >
          
          Getting started
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/2_using-weather-and-climate-data.html"
        >
          
            1.
          
          Using Weather and Climate Data
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/3_reduced-form-specification.html"
        >
          
            2.
          
          Developing a reduced-form specification
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry c-sidebar__entry--active"
          href="/4_weighting-schemes.html"
        >
          
            3.
          
          Weighting schemes
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="/5_geographical-unit-data.html"
        >
          
            4.
          
          Generating geographical unit data
        </a>

        
      </li>

      
    
      
      

      
      

      
      
      <li class="c-sidebar__chapter">
        <a class="c-sidebar__entry "
          href="https://github.com/atrisovic/weather-panel.github.io"
        >
          
          GitHub repository
        </a>

        
      </li>

      
    
      
      
        <li class="c-sidebar__divider"></li>
        
  </ul>
  <p class="sidebar_footer">Powered by <a href="https://jupyterbook.org">Jupyter Book</a></p>
</nav>

      
      <div class="c-topbar" id="top-navbar">
  <!-- We show the sidebar by default so we use .is-active -->
  <div class="c-topbar__buttons">
    <button
      id="js-sidebar-toggle"
      class="hamburger hamburger--arrowalt is-active"
    >
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="buttons">
<div class="download-buttons-dropdown">
    <button id="dropdown-button-trigger" class="interact-button"><img src="/assets/images/download-solid.svg" alt="Download" /></button>
    <div class="download-buttons">
        
        <a id="interact-button-print"><button id="interact-button-download" class="interact-button">.pdf</button></a>
    </div>
</div>


</div>

  </div>
  <!-- Empty sidebar placeholder that we'll auto-fill with javascript -->
  <aside class="sidebar__right">
    <header><h4 class="nav__title"><img src="/assets/images/list-solid.svg" alt="Search" />   On this page</h4></header>
    <nav class="onthispage">
    </nav>
  </aside>
  <a href="/search.html" class="topbar-right-button" id="search-button">
    <img src="/assets/images/search-solid.svg" alt="Search" />
  </a>
</div>

      <main class="c-textbook__page" tabindex="-1">
            <div class="c-textbook__content" id="textbook_content">
                  <main class="jupyter-page">
    <div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="4.-Weighting-schemes">4. Weighting schemes<a class="anchor-link" href="#4.-Weighting-schemes"> </a></h1><p>This section describes how to use different weighting schemes when aggregating gridded data to data regions.</p>
<h2 id="Why-spatial-weighting-schemes-matter">Why spatial weighting schemes matter<a class="anchor-link" href="#Why-spatial-weighting-schemes-matter"> </a></h2><p>Taking the unweighted average of weather within a region can misrepresent what populations, firms, or other phenomena of interest are exposed to. For example, an unweighted annual average temperature for Canada is about -8°C, but most of the population and agricultural activity is in climate zones with mean temperatures over 6°C, and the urban heat island effect can raise temperatures by another 4°C. The time of year matters too, and you should consider a weighting scheme across days within a year, or even hours within a day.</p>
<p>As described in section <a href="https://paper.dropbox.com/doc/Weather-Panel-Tutorial-Dealing-with-the-spatial-and-t-Y19yJIcW3pV0TW76gmp5H#:uid=202980750047650372256790&amp;amp;h2=Dealing-with-the-spatial-and-t">+Weather Panel Tutorial: Dealing-with-the-spatial-and-t</a>, the scale of a phenomenon matters. Many processes occur at a more local scale than that which data is collected. The motivation for weighting is different for aggregation that represents averaged phenomena vs. phenomena that respond to averaged weather, and the sequence of analysis changes.</p>
<p>In the first case, the phenomenon occurs locally, in response to local weather. In this case, we perform weighted aggregations to reflect the amount of the phenomenon in each location. For example, we would use population weighting to model the effects of heat on people. In this case, the order of operations is:</p>
<ol>
<li>Transform weather into the terms of the model specification.</li>
<li>Average these transformed terms across space using a weighting scheme.</li>
</ol>
<p>In the second case, the phenomenon occurs at a data region level, in response to averaged weather. In this case, the weighting scheme reflects the relative importance of weather in different regions to the whole. For example, weighting rainfall by the distance from a shore could be important to predict the declaration of states of emergency. The order of operations is:</p>
<ol>
<li>Average the weather across space using a weighting scheme.</li>
<li>Transform the averaged weather to the model specification.</li>
</ol>
<p>In either case, the weighting scheme is the same:</p>

<pre><code>$$T_{it} = \sum_{p \in P(i)} w_p T_{pt} \text{ such that } \sum_p w_{p \in P(i)} = 1 \,\,\,\forall i$$

</code></pre>
<p>where $$w_p$$ is the weight for pixel $$p$$, and $$P(i)$$ is the set of pixels in data region $$i$$.</p>
<h2 id="Kinds-of-weight-schemes-and-data-sources">Kinds of weight schemes and data sources<a class="anchor-link" href="#Kinds-of-weight-schemes-and-data-sources"> </a></h2><p>Weighting data files come in a wide range of file formats, since any gridded data file is appropriate. The most common data types are CSV, ASC, GeoTIFF, and BIL files. In each case, you (or your code) need to know (1) the format of the data values, (2) the spatial gridding scheme, (3) the projection, and (4) how missing data is handled.</p>
<ol>
<li>Format of the data values: Data values can be written out in text (as with CSV and ASC files) or in a binary representation (GeoTIFF and BIL). If the values are written as text, delimiters will be used to separate them (comma for CSV, spaces for ASC).</li>
<li>The spatial gridding scheme is determined by 6 numbers: a latitude and longitude of an origin point, a horizontal and vertical cell lengths, and a number of rows and columns.<ul>
<li>The most common origin point is the location of the lower-left corner of the lower-left grid cell. For example, for a global dataset, that might be 90°S, 180°W, which is represented in x, y coordinates as (-180, -90). Sometimes (particularly with NetCDF files), grid cell center locations will be used instead.</li>
<li>Grid cell sizes are often given as decimal representation of fractions of a degree, such as 0.0083333333333 = 1 / 120 of a degree. This is the grid cell size needed globally to ensure a km-scale resolution. Usually the horizontal and vertical grid cell lengths are the same, and reported as a single number.</li>
<li>The number of grid cells is the most common way to describe the spatial coverage of the dataset. A global dataset will have 180 / cellsize rows and 360 / cellsize columns.</li>
</ul>
</li>
</ol>

<pre><code>Based on this information, you can calculate which grid cell any point on the globe falls into:
    $$\text{row} = \text{floor}\left(\frac{\text{Latitude} - y_0}{\text{CellSize}}\right)$$, $$\text{column} = \text{floor}\left(\frac{\text{Longitude} - x_0}{\text{CellSize}}\right)$$
where $$x_0, y_0$$ is lower-left corner point. If the center of the lower-left cell was given, $$x_0 = x_\text{llcenter} - \frac{\text{CellSize}}{2}$$, $$y_0 = y_\text{llcenter} - \frac{\text{CellSize}}{2}$$.


For CSV files, you will need to keep track of this data yourself. ASC files have it at the top of the file, BIL files have a corresponding HDR file with the data, and GeoTIFF files have it embedded in the file which you can read with various software tools.


</code></pre>
<ol>
<li>Projections are a way to map points on the globe (in latitude-longitude space) to a point in a flat x, y space. While this is important for visualizing maps, it can just be a nuisance for gridded datasets. The most common “projection” for gridded datasets is an equirectangular projection, and we have been assuming this above. This is variously referred to as <code>1</code>, <code>ll</code>, <code>WGS 84</code>, and <code>EPSG: 4326</code> (techically, WGS 84 species how latitude and longitude are defined, and EPSG:4326 specifies a drawing scheme where x = longitude and y = latitude). However, you will sometimes enounter grids in terms of km north and km east of a point, and then you may need to project these back to latitude-longitude and regrid them.</li>
<li>All of these allow missing data to be handled. Typically, a specific numerical representation, like -9999, will be used. This is specified the same way that the gridding scheme is.</li>
</ol>
<p>Implementation Notes: Reading gridded data.</p>
<table>
<thead><tr>
<th>R</th>
<th>Python</th>
</tr>
</thead>
<tbody>
<tr>
<td>Use the <code>raster</code> library.</td>
<td>Take a look at <a href="https://github.com/jrising/research-common/tree/master/python/geogrid">https://github.com/jrising/research-common/tree/master/python/geogrid</a>.</td>
</tr>
</tbody>
</table>
<p>In some cases, it is appropriate and possible to use time-varying weighting schemes. For example, if population impacts are being studied, and the scale of the model is individuals, annual estimate of population can be used. This kind of data is often either in NetCDF format (see above), or as a collection of files.</p>
<p>Implementation Notes: Downloading multiple files and reading them.</p>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>library(raster)</code><br><code>for (year in 1980:2010) {</code><br>  <code>download.file(paste0(``"``http://archive.org/awesome/``"``, year,</code> <code>"``.zip``"``), "temp.zip")</code><br>  <code>filename &lt;- paste0("prefix-", year, ".asc")</code><br>  <code>zip.file.extract(filename,</code> <code>"``temp.zip``"``)</code><br>  <code>r &lt;- raster(filename)</code><br>  <code>&lt;perform weighting&gt;</code><br><code>}</code></td>
</tr>
</tbody>
</table>
<p>Below are some common datasources for various weighting schemes.</p>
<ul>
<li>Population is an important weighting scheme for social impacts.<ul>
<li>Gridded Population of the World: <a href="https://sedac.ciesin.columbia.edu/data/collection/gpw-v4">https://sedac.ciesin.columbia.edu/data/collection/gpw-v4</a>
  This is open-source, available at 30 arc-second resolution every 5 years from 2000 (or before with their previous version).</li>
<li>LandScan: <a href="https://landscan.ornl.gov/landscan-datasets">https://landscan.ornl.gov/landscan-datasets</a>
  LandScan is available at 30 arc-second resolution, annually, but previous years need to be purchased. As at your institution, as many already have it.</li>
</ul>
</li>
<li>Gridded agriculture information<ul>
<li>Global Agricultural Lands in the Year 2000: <a href="https://sedac.ciesin.columbia.edu/data/collection/aglands">https://sedac.ciesin.columbia.edu/data/collection/aglands</a></li>
<li>Also consider gridded land use datasets: <a href="https://www.atmos.illinois.edu/~meiyapp2/datasets.htm">https://www.atmos.illinois.edu/~meiyapp2/datasets.htm</a></li>
</ul>
</li>
<li>Look at the IRI Data Library for a large variety of datasets, available in any format: <a href="https://iridl.ldeo.columbia.edu/">https://iridl.ldeo.columbia.edu/</a>
## Aligning weather and weighting grids</li>
</ul>
<p>The first step to using a gridded weighting dataset is to make it conform to data grid definition used by your weather data. Here we assume that both are regular latitude-longitude grids. See <a href="https://paper.dropbox.com/doc/Weather-Panel-Tutorial-Kinds-of-weight-schemes-and-da-Y19yJIcW3pV0TW76gmp5H#:uid=481082604230980012799322&amp;amp;h2=Kinds-of-weight-schemes-and-da">+Weather Panel Tutorial: Kinds-of-weight-schemes-and-da</a> to understand the grid scheme for your weighting file; note that gridded weather data often reports the center of each grid cell, rather than the corner.</p>
<p>The following recipe should work for most cases to align weighting data with a weather grid.</p>
<ol>
<li><strong>Resample the weighting data until the grid of the weighting data evenly divides up the weather data.</strong>
 Resampling in this case means increasing the resolution of the weighting grid by some factor. You want to do this so that two conditions to be met after resampling: (A) The new resolution should be an integer multiple of the weather resolution. (B) The horizontal and vertical grid lines of the weather data coincide with the resampled grid lines of the weighting data.</li>
</ol>

<pre><code>Example: Suppose the weather data is nearly global, from 180°W to 180°E, 90°S to 86°N, as the case with LandScan population data. The resolution is 1/120th of a degree. You want to use this to weight PRISM data for the USA, with an extent 125.0208 to 66.47917°W, 24.0625 to 49.9375°N, with a resolution of 1/24th of a degree.
</code></pre>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>landscan &lt;- raster(``"``…/w001001.adf``"``)</code><br><code>landscan</code></td>
</tr>
<tr>
<td><code>class       : RasterLayer</code> <br><code>dimensions  : 21120, 43200, 912384000  (nrow, ncol, ncell)</code><br><code>resolution  : 0.008333333, 0.008333333  (x, y)</code><br><code>extent      : -180, 180, -90, 86  (xmin, xmax, ymin, ymax)</code></td>
</tr>
<tr>
<td><code>prism &lt;- raster(``"``PRISM_tmax_stable_4kmM2_2000_all_asc")</code><br><code>prism</code></td>
</tr>
<tr>
<td><code>class       : RasterLayer</code> <br><code>dimensions  : 621, 1405, 872505  (nrow, ncol, ncell)</code><br><code>resolution  : 0.04166667, 0.04166667  (x, y)</code><br><code>extent      : -125.0208, -66.47917, 24.0625, 49.9375  (xmin, xmax, ymin, ymax)</code></td>
</tr>
</tbody>
</table>

<pre><code>Start by throwing away extraneous data, by cropping the LandScan to, say,
126 to 66°W, 24 to 50°N.
</code></pre>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>landscan &lt;- crop(landscan, extent(-126, -66, 24, 50))</code></td>
</tr>
</tbody>
</table>

<pre><code>Now, note that the edge of the PRISM data is in the middle of the LandScan grid cells:
120 * (180 - 125.0208) = 6597.5
That means that you need to increase the resolution of the LandScan data by 2 to line it up. In general, you will need to increase it by 1 / (the trailing decimal).
</code></pre>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>landscan &lt;- disaggregate(landscan, fact=2) / 4</code></td>
</tr>
</tbody>
</table>

<pre><code>We divide by 4 so that the total population remains the same.


</code></pre>
<ol>
<li><strong>Clip the two datasets so that they line up.</strong></li>
</ol>

<pre><code>In the example above, after increasing the resolution of the LandScan data, we clip it again.
</code></pre>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>landscan &lt;- crop(landscan, extent(-125.0208, -66.47917, 24.0625, 49.9375))</code></td>
</tr>
</tbody>
</table>
<ol>
<li><strong>Re-aggregate the weighting data, so that it has the same resolution as the weather data.</strong></li>
</ol>

<pre><code>In the example above, the resolution of the dataset has become 1/240th, and we can write aggregate by a factor of 10 for it to match the PRISM data:
</code></pre>
<table>
<thead><tr>
<th>R</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>landscan &lt;- aggregate(landscan, fact=10, fun=sum)</code></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>

 


    </main>
    
            </div>
            <div class="c-textbook__footer" id="textbook_footer">
              <nav class="c-page__nav">
  
    
    <a id="js-page__nav__prev" class="c-page__nav__prev" href="/3_reduced-form-specification.html">
      〈 <span class="u-margin-right-tiny"></span> Developing a reduced-form specific...
    </a>
  

  
    
    <a id="js-page__nav__next" class="c-page__nav__next" href="/5_geographical-unit-data.html">
      Generating geographical unit data <span class="u-margin-right-tiny"></span> 〉
    </a>
  
</nav>

              <footer>
  <p class="footer">This page was created by <a href="https://github.com/jupyter/jupyter-book/graphs/contributors">The Jupyter Book Community</a></p>
</footer>

            </div>

        </div>
      </main>
    </div>
  </body>
</html>
