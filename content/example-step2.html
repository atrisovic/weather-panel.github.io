

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Hands-On Exercise, Step 2: Preparing the Demographic Data</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/example-step2';</script>
    <link rel="shortcut icon" href="../_static/favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Generating geographical unit data" href="geographical-unit-data.html" />
    <link rel="prev" title="Functional forms: pros, cons, and methods" href="functional-forms.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="getting-started.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/climate_estimate_logo.png" class="logo__image only-light" alt=" - Home"/>
    <script>document.write(`<img src="../_static/climate_estimate_logo.png" class="logo__image only-dark" alt=" - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="getting-started.html">
                    Introduction to the Tutorial
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Weather and Climate Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="weather-and-climate-data.html">Introduction to Weather and Climate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="netcdfs-and-basic-coding.html">Weather and Climate Data Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="gridded-data.html">Working with Gridded Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-data-product.html">Choosing and Downloading Weather and Climate Data Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-step1.html">Hands-On Exercise, Step 1: Preparing the Weather Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Developing a reduced-form specification</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="reduced-form-specification.html">Developing a reduced-form specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="functional-forms.html">Functional forms: pros, cons, and methods</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Hands-On Exercise, Step 2: Preparing the Demographic Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geographical unit data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="geographical-unit-data.html">Generating geographical unit data</a></li>
<li class="toctree-l1"><a class="reference internal" href="working-with-shapefiles.html">Constructing weather averages within spatial units</a></li>
<li class="toctree-l1"><a class="reference internal" href="weighting-schemes.html">Weighting schemes</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-step3.html">Hands-On Exercise, Step 3: Aggregating the data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Bringing it all together</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="regression-pointers.html">Some pointers when performing regressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="example-step4.html">Hands-On Exercise, Step 4: Regression results</a></li>
<li class="toctree-l1"><a class="reference internal" href="suggestions.html">Suggestions for work organization</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributors</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/atrisovic/weather-panel.github.io" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/atrisovic/weather-panel.github.io/edit/master/tutorial-content/content/example-step2.md" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/atrisovic/weather-panel.github.io/issues/new?title=Issue%20on%20page%20%2Fcontent/example-step2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/example-step2.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hands-On Exercise, Step 2: Preparing the Demographic Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thinking-about-the-data-generating-process">Thinking about the data-generating process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-population-data">Download the population data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-mortality-data">Downloading the mortality data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-mortality-data">Preparing the mortality data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hands-on-exercise-step-2-preparing-the-demographic-data">
<h1>Hands-On Exercise, Step 2: Preparing the Demographic Data<a class="headerlink" href="#hands-on-exercise-step-2-preparing-the-demographic-data" title="Permalink to this heading">#</a></h1>
<section id="thinking-about-the-data-generating-process">
<h2>Thinking about the data-generating process<a class="headerlink" href="#thinking-about-the-data-generating-process" title="Permalink to this heading">#</a></h2>
<p>First, let us think about the process that relates mortality to
weather. Weather fluctations can have impacts on all scales, but
generally when we are thinking of heat waves killing people, it is
because of direct exposure. The main data-generating process is local.</p>
<p>It is also non-linear. Both cold and hot weather kills people,
relative to deaths at moderate (pleasant) temperatures. We can model
this with a quadratic relationship. We need to choose some baseline
temperature for comparison purposes. For our example, we will use 20
C. The dose-response function will describe excess mortality, relative
to a day with an average temperature of 20 C.</p>
<p>We also need to weight our pixel data. We want the dose-response
function to be representative of a random individual, not a random
region-year data point, so we will weight gridcells by population.</p>
<p>Finally, the mortality data we will use is annual, while the weather
data is daily. We still want to estimate a daily dose-response
function, so we will say that take sums over all days of both the
weather and outcome data. The sum over daily death data is annual
death data, which is what we have.</p>
<p>Then, we want to transform the weather data by creating two predictor
variables, for the linear and quadratic terms relative to 20 C.</p>
<div class="math notranslate nohighlight">
\[X_{1, i, y} = \sum_{t \in \text{Year}(y)} \sum_{p \in \Theta(i)} w_p (T_{p i t} - 20)\]</div>
<div class="math notranslate nohighlight">
\[X_{2, i, y} = \sum_{t \in \text{Year}(y)} \sum_{p \in \Theta(i)} w_p (T_{p i t}^2 - 20^2)\]</div>
<p>where <span class="math notranslate nohighlight">\(w_p\)</span> is the population in gridcell <span class="math notranslate nohighlight">\(p\)</span>.</p>
</section>
<section id="download-the-population-data">
<h2>Download the population data<a class="headerlink" href="#download-the-population-data" title="Permalink to this heading">#</a></h2>
<p>We can use the gridded population data from Gridded Population of the
World, since the weather data is not very high resolution. Download it
from
<a class="reference external" href="https://sedac.ciesin.columbia.edu/data/set/gpw-v3-population-count">https://sedac.ciesin.columbia.edu/data/set/gpw-v3-population-count</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Raster data is a type of digital image represented by reducible and
enlargeable grids. Each cell (often referred to as a pixel) within this
grid contains a value representing information, such as temperature,
elevation, or a color value for image data. Each pixel stores a single
value, and when visualized collectively, these pixels can represent
complex images or spatial information. See more
<a class="reference external" href="https://desktop.arcgis.com/en/arcmap/latest/manage-data/raster-and-images/what-is-raster-data.htm">here</a>
and <a class="reference external" href="https://datacarpentry.org/organization-geospatial/01-intro-raster-data">here</a>.</p>
<p>Common file formats for raster data include GeoTIFF, NetCDF, HDF, JPEG2000,
and BIL, among others.</p>
</div>
<p>The code below assumes that you download the USA population count grid
as a <code class="docutils literal notranslate"><span class="pre">.bil</span></code> format at 2.5’ resolution for 1990 (these are all options
on the Gridded Population of the World download form). The zip file
produced will contain a <code class="docutils literal notranslate"><span class="pre">usap90ag.bil</span></code> file, along with other
associated files that are required for this file to be loaded. For the
code below to work, the contents of the zip file should be placed in a
<code class="docutils literal notranslate"><span class="pre">data/pcount</span></code> directory.</p>
<p>Although this is US-specific data, the coverage extends far beyond the
contiguous US. It will be useful to clip it more tightly and aggregate
it to the scale of the weather. We also need it in NetCDF format, for
the aggregation step. Again, this code assumes that it is being run
from a directory <code class="docutils literal notranslate"><span class="pre">code</span></code>, sister to the <code class="docutils literal notranslate"><span class="pre">data</span></code> directory.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
R</label><div class="sd-tab-content docutils">
<p>The R library <code class="docutils literal notranslate"><span class="pre">raster</span></code> is used for reading, writing, manipulating, analyzing
and modeling of spatial data.</p>
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
<span class="n">rr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">raster</span><span class="p">(</span><span class="s">&quot;../data/pcount/usap90ag.bil&quot;</span><span class="p">)</span>

<span class="n">rr2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">aggregate</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="w"> </span><span class="n">fact</span><span class="o">=</span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">sum</span><span class="p">)</span>
<span class="n">rr3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">crop</span><span class="p">(</span><span class="n">rr2</span><span class="p">,</span><span class="w"> </span><span class="nf">extent</span><span class="p">(</span><span class="m">-126</span><span class="p">,</span><span class="w"> </span><span class="m">-65</span><span class="p">,</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="m">51</span><span class="p">))</span>

<span class="nf">writeRaster</span><span class="p">(</span><span class="n">rr3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;../data/pcount/usap90ag.nc&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="n">overwrite</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="o">=</span><span class="s">&quot;CDF&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">varname</span><span class="o">=</span><span class="s">&quot;Population&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">varunit</span><span class="o">=</span><span class="s">&quot;people&quot;</span><span class="p">,</span>
<span class="w"> </span><span class="n">xname</span><span class="o">=</span><span class="s">&quot;lon&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">yname</span><span class="o">=</span><span class="s">&quot;lat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
Python</label><div class="sd-tab-content docutils">
<p>You will need to install the <code class="docutils literal notranslate"><span class="pre">rioxarray</span></code> package, using <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">rioxarray</span></code>, to open the <code class="docutils literal notranslate"><span class="pre">.bil</span></code> files.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rioxarray</span>
<span class="n">rr</span> <span class="o">=</span> <span class="n">rioxarray</span><span class="o">.</span><span class="n">open_rasterio</span><span class="p">(</span><span class="s2">&quot;../data/pcount/usap90ag.bil&quot;</span><span class="p">)</span>
<span class="n">rr</span> <span class="o">=</span> <span class="n">rr</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Crop to US bounding box</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">126</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">65</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="mi">23</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">51</span>

<span class="n">sel_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">)</span>
<span class="n">sel_lat</span> <span class="o">=</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">)</span>
<span class="n">rr2</span> <span class="o">=</span> <span class="n">rr</span><span class="p">[</span><span class="n">sel_lat</span><span class="p">,</span> <span class="n">sel_lon</span><span class="p">]</span>

<span class="c1"># Aggregate to 1-degree cells</span>
<span class="n">rr3</span> <span class="o">=</span> <span class="n">rr2</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">rr3</span> <span class="o">=</span> <span class="n">rr3</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;lat&#39;</span><span class="p">)</span>
<span class="n">rr3</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Population&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s2">&quot;../data/pcount/usap90ag.nc4&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Further details on the use of geographic data are discussed in the next chapter.</p>
</section>
<section id="downloading-the-mortality-data">
<h2>Downloading the mortality data<a class="headerlink" href="#downloading-the-mortality-data" title="Permalink to this heading">#</a></h2>
<p>The Compressed Mortality File (CMF) provides comprehensive,
county-scale mortality data for the United States. The data through
1988 is publically available, so we will use this for our analysis.</p>
<ol class="arabic simple">
<li><p>Go to the CMF information page,
<a class="reference external" href="https://www.cdc.gov/nchs/data_access/cmf.htm">https://www.cdc.gov/nchs/data_access/cmf.htm</a>.</p></li>
<li><p>Under “Data Availability”, find the mortality and population files
for 1979 - 1988, and download these.</p></li>
<li><p>Unzip these files, and place the resulting text files,
<code class="docutils literal notranslate"><span class="pre">Mort7988.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">Pop7988.txt</span></code> into the <code class="docutils literal notranslate"><span class="pre">data/cmf</span></code> folder.</p></li>
</ol>
<p>These files report data as fixed-width ASCII text, meaning that spans
of characters on each line represent columns of the data.</p>
<p>In the mortality data file, <code class="docutils literal notranslate"><span class="pre">Mort7988.txt</span></code>, here are the elements of
interest: Characters 1 - 5 provide the FIPS code (FIPS is a 5 digit
code uniquely identifying each county in the US). Characters 6 - 9
report the year of death. The next few columns give the race, age, and
cause of death, but we will combine results across all of
these. Characters 20 - 23 report the number of deaths that correspond
to that county, year, race, age, and cause.</p>
<p>In the population data file, <code class="docutils literal notranslate"><span class="pre">Pop7988.txt</span></code>, the lines start with FIPS
codes and years, like the mortality data. But then the age groups are
all listed on the line: starting with character 19, the population in
each of 12 age groups is reported with 8 characters per age group
number (so, the first age group, 1 - 4 year-olds, is characters 19 -
26; then 5 - 9 year-olds is reported in characters 27 - 34; and so
on).</p>
<p>The population file also contains US-wide population numbers,
state-wide numbers, and county-level numbers. These are identified by
a column in the data with a 1 (US), 2 (state), or 3 (county). In the
code below, we label this the <code class="docutils literal notranslate"><span class="pre">type</span></code> column and only include type = 3
data.</p>
</section>
<section id="preparing-the-mortality-data">
<h2>Preparing the mortality data<a class="headerlink" href="#preparing-the-mortality-data" title="Permalink to this heading">#</a></h2>
<p>Here we sum across all races and ages and merge the mortality and
population data.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
R</label><div class="sd-tab-content docutils">
<div class="highlight-R notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>

<span class="n">df.mort</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.fwf</span><span class="p">(</span><span class="s">&quot;../data/cmf/Mort7988.txt&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;fips&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;year&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;ignore&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;deaths&#39;</span><span class="p">))</span>

<span class="n">df2.mort</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.mort</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">fips</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">deaths</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">deaths</span><span class="p">))</span>

<span class="n">df.pop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read.fwf</span><span class="p">(</span><span class="s">&quot;../data/cmf/Pop7988.txt&quot;</span><span class="p">,</span>
<span class="w">   </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">8</span><span class="p">,</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">col.names</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;fips&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;year&#39;</span><span class="p">,</span>
<span class="w">   </span><span class="s">&#39;ignore&#39;</span><span class="p">,</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&#39;pop&#39;</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">12</span><span class="p">),</span><span class="w"> </span><span class="s">&#39;county&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;type&#39;</span><span class="p">))</span>

<span class="n">df2.pop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.pop</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">group_by</span><span class="p">(</span><span class="n">fips</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span><span class="n">pop</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">pop1</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="n">pop2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop7</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop9</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop10</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="n">pop11</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pop12</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="n">type</span><span class="p">[</span><span class="m">1</span><span class="p">])</span>

<span class="n">df3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df2.pop</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="nf">left_join</span><span class="p">(</span><span class="n">df2.mort</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;fips&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;year&#39;</span><span class="p">))</span>
<span class="n">df3</span><span class="o">$</span><span class="n">deaths</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df3</span><span class="o">$</span><span class="n">deaths</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>

<span class="n">df4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">subset</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">3</span><span class="p">)</span>

<span class="nf">write.csv</span><span class="p">(</span><span class="n">df4</span><span class="p">[,</span><span class="w"> </span><span class="o">-</span><span class="nf">which</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">df4</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;type&#39;</span><span class="p">)],</span><span class="w"> </span><span class="s">&quot;../data/cmf/merged.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="o">=</span><span class="bp">F</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
Python</label><div class="sd-tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df_mort</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/cmf/Mort7988.txt&quot;</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>

<span class="c1"># parse input</span>
<span class="n">df_mort2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_mort</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">x</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">slc</span><span class="p">)]</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))]])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
	<span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;deaths&#39;</span><span class="p">])</span>

<span class="n">df_mort3</span> <span class="o">=</span> <span class="n">df_mort2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">df_mort4</span> <span class="o">=</span> <span class="n">df_mort3</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_mort4</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>fips</p></th>
<th class="head"><p>year</p></th>
<th class="head text-right"><p>deaths</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1979</p></td>
<td class="text-right"><p>225</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1980</p></td>
<td class="text-right"><p>221</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1981</p></td>
<td class="text-right"><p>221</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1982</p></td>
<td class="text-right"><p>223</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1983</p></td>
<td class="text-right"><p>267</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df_pop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/cmf/Pop7988.txt&quot;</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;input&#39;</span><span class="p">])</span>

<span class="n">slices</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">18</span><span class="p">)]</span> <span class="o">+</span> \
         <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span> <span class="o">+</span> \
         <span class="p">[(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">139</span><span class="p">),</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span> <span class="mi">140</span><span class="p">)]</span>

<span class="c1"># parse input</span>
<span class="n">df_pop2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_pop</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">x</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">slc</span><span class="p">)]</span> <span class="k">for</span> <span class="n">slc</span> <span class="ow">in</span> <span class="n">slices</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
	<span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;ignore&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;pop&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;pop&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span>
<span class="n">df_pop3</span> <span class="o">=</span> <span class="n">df_pop2</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_pop4</span> <span class="o">=</span> <span class="n">df_pop3</span><span class="p">[</span><span class="n">df_pop3</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">df_pop5</span> <span class="o">=</span> <span class="n">df_pop4</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_pop5</span><span class="p">[</span><span class="s1">&#39;pop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop1</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop2</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop3</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop4</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop5</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop6</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop7</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop8</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop9</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop10</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop11</span> <span class="o">+</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">pop12</span>

<span class="n">df_pop5</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>fips</p></th>
<th class="head"><p>year</p></th>
<th class="head"><p>type</p></th>
<th class="head text-right"><p>pop1</p></th>
<th class="head text-right"><p>pop2</p></th>
<th class="head text-right"><p>pop3</p></th>
<th class="head text-right"><p>pop4</p></th>
<th class="head text-right"><p>pop5</p></th>
<th class="head text-right"><p>pop6</p></th>
<th class="head text-right"><p>pop7</p></th>
<th class="head text-right"><p>pop8</p></th>
<th class="head text-right"><p>pop9</p></th>
<th class="head text-right"><p>pop10</p></th>
<th class="head text-right"><p>pop11</p></th>
<th class="head text-right"><p>pop12</p></th>
<th class="head text-right"><p>pop</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1979</p></td>
<td><p>3</p></td>
<td class="text-right"><p>2022</p></td>
<td class="text-right"><p>2982</p></td>
<td class="text-right"><p>3248</p></td>
<td class="text-right"><p>3491</p></td>
<td class="text-right"><p>2640</p></td>
<td class="text-right"><p>4414</p></td>
<td class="text-right"><p>4211</p></td>
<td class="text-right"><p>3310</p></td>
<td class="text-right"><p>2457</p></td>
<td class="text-right"><p>1813</p></td>
<td class="text-right"><p>779</p></td>
<td class="text-right"><p>178</p></td>
<td class="text-right"><p>31545</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1980</p></td>
<td><p>3</p></td>
<td class="text-right"><p>2021</p></td>
<td class="text-right"><p>2952</p></td>
<td class="text-right"><p>3184</p></td>
<td class="text-right"><p>3495</p></td>
<td class="text-right"><p>2663</p></td>
<td class="text-right"><p>4463</p></td>
<td class="text-right"><p>4293</p></td>
<td class="text-right"><p>3373</p></td>
<td class="text-right"><p>2487</p></td>
<td class="text-right"><p>1848</p></td>
<td class="text-right"><p>795</p></td>
<td class="text-right"><p>181</p></td>
<td class="text-right"><p>31755</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1981</p></td>
<td><p>3</p></td>
<td class="text-right"><p>2037</p></td>
<td class="text-right"><p>2776</p></td>
<td class="text-right"><p>3132</p></td>
<td class="text-right"><p>3320</p></td>
<td class="text-right"><p>2664</p></td>
<td class="text-right"><p>4646</p></td>
<td class="text-right"><p>4210</p></td>
<td class="text-right"><p>3330</p></td>
<td class="text-right"><p>2516</p></td>
<td class="text-right"><p>1829</p></td>
<td class="text-right"><p>824</p></td>
<td class="text-right"><p>192</p></td>
<td class="text-right"><p>31476</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1982</p></td>
<td><p>3</p></td>
<td class="text-right"><p>2042</p></td>
<td class="text-right"><p>2707</p></td>
<td class="text-right"><p>3098</p></td>
<td class="text-right"><p>3190</p></td>
<td class="text-right"><p>2651</p></td>
<td class="text-right"><p>4714</p></td>
<td class="text-right"><p>4343</p></td>
<td class="text-right"><p>3327</p></td>
<td class="text-right"><p>2565</p></td>
<td class="text-right"><p>1835</p></td>
<td class="text-right"><p>856</p></td>
<td class="text-right"><p>201</p></td>
<td class="text-right"><p>31529</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1983</p></td>
<td><p>3</p></td>
<td class="text-right"><p>2044</p></td>
<td class="text-right"><p>2670</p></td>
<td class="text-right"><p>3054</p></td>
<td class="text-right"><p>3063</p></td>
<td class="text-right"><p>2625</p></td>
<td class="text-right"><p>4815</p></td>
<td class="text-right"><p>4408</p></td>
<td class="text-right"><p>3325</p></td>
<td class="text-right"><p>2613</p></td>
<td class="text-right"><p>1833</p></td>
<td class="text-right"><p>882</p></td>
<td class="text-right"><p>215</p></td>
<td class="text-right"><p>31547</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_pop5</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_mort4</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fips&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;../data/cmf/merged.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The final dataset (<code class="docutils literal notranslate"><span class="pre">merged.csv</span></code>) should look like:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>fips</p></th>
<th class="head"><p>year</p></th>
<th class="head text-right"><p>pop1</p></th>
<th class="head text-right"><p>pop2</p></th>
<th class="head text-right"><p>pop3</p></th>
<th class="head text-right"><p>pop4</p></th>
<th class="head text-right"><p>pop5</p></th>
<th class="head text-right"><p>pop6</p></th>
<th class="head text-right"><p>pop7</p></th>
<th class="head text-right"><p>pop8</p></th>
<th class="head text-right"><p>pop9</p></th>
<th class="head text-right"><p>pop10</p></th>
<th class="head text-right"><p>pop11</p></th>
<th class="head text-right"><p>pop12</p></th>
<th class="head text-right"><p>pop</p></th>
<th class="head text-right"><p>deaths</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1979</p></td>
<td class="text-right"><p>2022</p></td>
<td class="text-right"><p>2982</p></td>
<td class="text-right"><p>3248</p></td>
<td class="text-right"><p>3491</p></td>
<td class="text-right"><p>2640</p></td>
<td class="text-right"><p>4414</p></td>
<td class="text-right"><p>4211</p></td>
<td class="text-right"><p>3310</p></td>
<td class="text-right"><p>2457</p></td>
<td class="text-right"><p>1813</p></td>
<td class="text-right"><p>779</p></td>
<td class="text-right"><p>178</p></td>
<td class="text-right"><p>31545</p></td>
<td class="text-right"><p>225</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1980</p></td>
<td class="text-right"><p>2021</p></td>
<td class="text-right"><p>2952</p></td>
<td class="text-right"><p>3184</p></td>
<td class="text-right"><p>3495</p></td>
<td class="text-right"><p>2663</p></td>
<td class="text-right"><p>4463</p></td>
<td class="text-right"><p>4293</p></td>
<td class="text-right"><p>3373</p></td>
<td class="text-right"><p>2487</p></td>
<td class="text-right"><p>1848</p></td>
<td class="text-right"><p>795</p></td>
<td class="text-right"><p>181</p></td>
<td class="text-right"><p>31755</p></td>
<td class="text-right"><p>221</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1981</p></td>
<td class="text-right"><p>2037</p></td>
<td class="text-right"><p>2776</p></td>
<td class="text-right"><p>3132</p></td>
<td class="text-right"><p>3320</p></td>
<td class="text-right"><p>2664</p></td>
<td class="text-right"><p>4646</p></td>
<td class="text-right"><p>4210</p></td>
<td class="text-right"><p>3330</p></td>
<td class="text-right"><p>2516</p></td>
<td class="text-right"><p>1829</p></td>
<td class="text-right"><p>824</p></td>
<td class="text-right"><p>192</p></td>
<td class="text-right"><p>31476</p></td>
<td class="text-right"><p>221</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>1001</p></td>
<td><p>1982</p></td>
<td class="text-right"><p>2042</p></td>
<td class="text-right"><p>2707</p></td>
<td class="text-right"><p>3098</p></td>
<td class="text-right"><p>3190</p></td>
<td class="text-right"><p>2651</p></td>
<td class="text-right"><p>4714</p></td>
<td class="text-right"><p>4343</p></td>
<td class="text-right"><p>3327</p></td>
<td class="text-right"><p>2565</p></td>
<td class="text-right"><p>1835</p></td>
<td class="text-right"><p>856</p></td>
<td class="text-right"><p>201</p></td>
<td class="text-right"><p>31529</p></td>
<td class="text-right"><p>223</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>1001</p></td>
<td><p>1983</p></td>
<td class="text-right"><p>2044</p></td>
<td class="text-right"><p>2670</p></td>
<td class="text-right"><p>3054</p></td>
<td class="text-right"><p>3063</p></td>
<td class="text-right"><p>2625</p></td>
<td class="text-right"><p>4815</p></td>
<td class="text-right"><p>4408</p></td>
<td class="text-right"><p>3325</p></td>
<td class="text-right"><p>2613</p></td>
<td class="text-right"><p>1833</p></td>
<td class="text-right"><p>882</p></td>
<td class="text-right"><p>215</p></td>
<td class="text-right"><p>31547</p></td>
<td class="text-right"><p>267</p></td>
</tr>
</tbody>
</table>
<p>You may also have a <code class="docutils literal notranslate"><span class="pre">type</span></code> column, if you used the python code.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="functional-forms.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Functional forms: pros, cons, and methods</p>
      </div>
    </a>
    <a class="right-next"
       href="geographical-unit-data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Generating geographical unit data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thinking-about-the-data-generating-process">Thinking about the data-generating process</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-population-data">Download the population data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-the-mortality-data">Downloading the mortality data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-mortality-data">Preparing the mortality data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2020.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>